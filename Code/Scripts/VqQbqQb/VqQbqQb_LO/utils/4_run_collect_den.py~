import os
import shutil
import subprocess
import concurrent.futures 


if not os.path.exists("./tmp/den"):
   os.makedirs("./tmp/den")
else:
   shutil.rmtree("./tmp/den")
   os.makedirs("./tmp/den")


def run_form(i, j):
    command = f'form -d loopind1={i} -d loopind2={j} ./utils/show_den.frm'
    subprocess.run(command, shell=True)


mw = int(input("Enter the max number of parallel jobs: "))




with open("./process_header.h", "r") as file:
    line = file.readline().strip()  # Read first line and remove extra spaces/newlines
    ndiag1=int((line.split(" ")[2]).split("\"")[1])

with open("./process_header.h", "r") as file:
    line = file.readline().strip()  # Read first line and remove extra spaces/newlines
    ndiag2=int((line.split(" ")[2]).split("\"")[1])



print("Number of diagram of amp1 is", ndiag1)
print("Number of diagram of amp2 is", ndiag2)


#with concurrent.futures.ProcessPoolExecutor(max_workers=mw) as executor:
#        futures = [executor.submit(run_form, i, j) for i in range(1, ndiag1+1) for j in range(1, ndiag2+1)]
#concurrent.futures.wait(futures)


with concurrent.futures.ProcessPoolExecutor(max_workers=mw) as executor:
        futures = [executor.submit(run_form, i, j) for i in range(4,5) for j in range(5,6)]
        concurrent.futures.wait(futures)



