off statistics;
#-
#include all_header.h
#include process_header.h

#message Including diagrams

#if 'NLOOP' > 0
#do n = 1,'NDIAG'
g [diag'n'] = diag'n';
#enddo
#else
#do n = 1,'NDIAG'
g [diag'n'] = diag'n';
#enddo
#endif


#include ./external/'PROC'.'NLOOP'.inc
#message loaded QGRAF diagram
.sort


#message include parser: manipulating QGRAF output
#include parser.h


#do n = 1,'NDIAG'
#write <tmp/'PROC'_parsed.'NLOOP'.h> "id diag'n' = %e" [diag'n']
#enddo
#message parsed diagrams, written output in tmp/




#include separate_colour.h
#message inserted colour Feynman rules
#include color.h
#call coloralgebra
*P;
*.end
.sort
#message done color algebra


#do n = 1,'NDIAG'
g diagN'n' = [diag'n'];
.sort
#enddo



*#if 'NDIAG' == 1
*g 'PROC'ampl = [diag1];
*#elseif 'NDIAG' == 2
*g 'PROC'ampl = [diag1]+[diag2];
*#elseif 'NDIAG' > 2
*g 'PROC'ampl = diagN1 + ... + diagN'NDIAG';
*g 'PROC'ampl = diagN1;
*#endif
*.sort

#message building spinlines
#include spinlines.h
.sort



id Spin(1,?x, p2?) = Spin(1,?x)*Spin(1,p2);
.sort
repeat;
id Spin(1,?x, nu?)*Spin(1,?p2) = Spin(1,?x)*Spin(1,nu,?p2);
endrepeat;
id Spin(1) = 1;
.sort


id Spin(2,?x, p2?) = Spin(2,?x)*Spin(2,p2);
.sort
repeat;
id Spin(2,?x, nu?)*Spin(2,?p2) = Spin(2,?x)*Spin(2,nu,?p2);
endrepeat;
id Spin(2) = 1;
.sort


#do loopind=1,'NDIAG'
b Spin, d_, pQuark, pgluon;
.sort
b Spin, d_, pQuark, pgluon;
#write <tmp/parsed_diagrams/diag'loopind'_'PROC'_colour_out.'NLOOP'.dat> "l [diag'loopind'] = %e " [diag'loopind']
.sort
#enddo

#message performed colour algebra and built spinlines and  written output in tmp/parsed_diag
#include showlayers.h

.end





#+