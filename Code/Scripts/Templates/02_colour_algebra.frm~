#-
#include all_header.h
#include process_header.h

#if 'Nloop' > 0
#do n = 1,'Ndiag'
g [diag'n'] = diag'n'*DiaMatch('n');
#enddo
#else
#do n = 1,'Ndiag'
g [diag'n'] = diag'n'*Sector(TREE, 1);
#enddo
#endif

#include ./external/&proc&.&nloop&.inc
#message loaded QGRAF diagram
 
#if 'Nloop' > 0 
#include ./external/&proc&.&nloop&.shifts.inc
#endif

.sort

*Changes based on Nloops
#if 'Nloop' == 1
id Shift(k1?, p1?, []) = replace_(k1,p1);
#elseif 'Nloop' == 2
id Shift(k1?, p1?, [], k2?, p2?, []) = replace_(k1,p1,k2,p2);
#elseif 'Nloop' == 3
id Shift(k1?, p1?, [], k2?, p2?, [], k3?, p3?, []) = replace_(k1,p1,k2,p2,k3,p3);
#endif
.sort

#message applied Reduze shifts
multiply replace_(q, -p1-p2-p3);
.sort
 
#include parser.h

b Sector;
.sort

#do n = 1,'Ndiag'
#write <tmp/&proc&_parsed.&nloop&.h> "id diag'n' = %e" [diag'n']
#enddo
#message parsed diagrams, written output in tmp/


#include separate_colour.h
#message inserted colour Feynman rules
#include color.h


#call  coloralgebra
.sort
#include spinlines.h
b Sector, i_, gs, lambda, T, f, s, pol, Nc, Nf, NfZ;
.sort
#do n = 1,'Ndiag'
#write <tmp/colour_out.&nloop&.dat> "diag'n' = %e" [diag'n']
#enddo
#message performed colour algebra and written output in tmp/

*#do n = 1,11
*id FRules['n'](?x) = 1;
*#enddo
*id pol(?x) = 1;
*id Sector(?x) = 1;
*id gs = 1;
*print+s;
.end
#+
